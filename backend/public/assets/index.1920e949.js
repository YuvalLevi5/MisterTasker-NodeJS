var I=Object.defineProperty;var D=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var A=(t,e,s)=>e in t?I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,U=(t,e)=>{for(var s in e||(e={}))L.call(e,s)&&A(t,s,e[s]);if(D)for(var s of D(e))R.call(e,s)&&A(t,s,e[s]);return t};import{a as P,l as M,o as l,c as d,b as r,t as k,n as N,w as E,d as h,r as C,F as w,e as S,f as y,v as _,g as m,h as x,i as $,j as V,k as O,m as F}from"./vendor.76a1aad2.js";const W=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))u(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&u(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function u(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}};W();const q="/api/task";var G=P.create({withCredentials:!0});const f={get(t,e){return b(t,"GET",e)},post(t,e){return b(t,"POST",e)},put(t,e){return b(t,"PUT",e)},delete(t,e){return b(t,"DELETE",e)}};async function b(t,e="GET",s=null){try{return(await G({url:`${q}${t}`,method:e,data:s,params:e==="GET"?s:null})).data}catch(u){throw console.log(`Had Issues ${e}ing to the backend, endpoint: ${t}, with data:`,s),console.dir(u),u.response&&u.response.status,u}}const p={getTasks:j,getById:z,remove:H,save:Y,startTask:Z,generateTasks:Q,clearTasks:X,toggleWorker:tt,getWorkerStatus:et,getEmptyTask:st};async function j(t={sortTxt:"title",sortDir:1}){return f.get("/",t)}async function z(t){return f.get(`/${t}`).data}async function H(t){return f.delete(`/${t}`)}async function K(t){return f.put(`/${t._id}`,t)}async function J(t){return f.post("/",t)}async function Q(){return f.get("/generate")}async function X(){return f.delete("/")}function Y(t){return t._id?K(t):J(t)}async function Z(t){return f.post(`/${t._id}/start`)}function tt(){return f.post("/toggle")}function et(){return f.get("/workerStatus")}function st(){return{title:"",importance:1}}const nt="",rt={getSocket:ot,emit:at};function ot(){return M(`${nt}`,{withCredentials:!0,transports:["websocket","polling"]})}function at(t,e,s){t.emit(e,s)}var v=(t,e)=>{const s=t.__vccOpts||t;for(const[u,o]of e)s[u]=o;return s};const it={done:"Done",fail:"Fail",running:"Running"},lt={props:{task:Object},computed:{status(){return it[this.task.status]},statusClass(){return this.status&&this.status.toLocaleLowerCase()},actionTxt(){var t=this.task.status;return t==="fail"?"Retry":"Start"},showBtn(){return this.task.status!=="done"&&this.task.status!=="running"}},methods:{performTask(t){this.$emit("performTask",t)},removeTask(t){this.$emit("removeTask",t)}}},dt={class:"importance-td"},ut={class:"tries-td"},ct={class:"action-td"};function kt(t,e,s,u,o,n){return l(),d("tr",null,[r("td",null,k(s.task.title),1),r("td",dt,k(s.task.importance),1),r("td",{class:N([n.statusClass,"status-td"])},k(n.status),3),r("td",ut,k(s.task.triesCount),1),r("td",ct,[n.showBtn?(l(),d("button",{key:0,class:"btn action",onClick:e[0]||(e[0]=E(i=>n.performTask(s.task),["stop"]))},k(n.actionTxt),1)):h("",!0),s.task.status==="done"?(l(),d("button",{key:1,class:"btn delete",onClick:e[1]||(e[1]=E(i=>n.removeTask(s.task._id),["stop"]))},"Delete")):h("",!0)])])}var mt=v(lt,[["render",kt]]);const pt={components:{taskTableRow:mt},props:{tasks:{type:Array,required:!0},sortTxt:{type:String,default:"title"},sortDir:{type:Number,default:1}},data(){return{newTask:p.getEmptyTask(),opened:[]}},computed:{sortDirArrow(){return this.sortDir===1?"\u2193":"\u2191"}},methods:{descriptionChanged(t,e){const s=this.tasks.find(u=>u._id===t);s.description!==e&&(s.description=e,this.$emit("updateTask",s))},toggleDescription(t){const e=this.opened.indexOf(t);e>-1?this.opened.splice(e,1):this.opened.push(t)},performTask(t){this.$emit("performTask",t)},removeTask(t){this.$emit("removeTask",t)},addTask(){if(!this.newTask.title){alert("Title can not be empty");return}this.$emit("addTask",U({},this.newTask)),this.newTask=p.getEmptyTask()}}},ht={class:"table-container"},ft={class:"task-table"},Tt=m(" Title "),yt={key:0,class:"sort-icon"},_t=m(" Importance "),gt={key:0,class:"sort-icon"},vt=m(" Status "),bt={key:0,class:"sort-icon"},Ct=m(" Tries Count "),wt={key:0,class:"sort-icon"},xt=r("th",null,"Actions",-1),Bt={key:0},St={colspan:"5"},Dt=r("h4",null,"Description:",-1),At=["onBlur"],Ut={key:0},Et=r("h4",null,"Errors:",-1),Vt={key:0},It={class:"more-info"},Lt=["onClick"],Rt=m("Task title: "),Pt={colspan:"3"},Mt=m("Importance: "),Nt={class:"save-task-btn"};function $t(t,e,s,u,o,n){const i=C("task-table-row");return l(),d("div",ht,[r("table",ft,[r("thead",null,[r("tr",null,[r("th",{onClick:e[0]||(e[0]=a=>t.$emit("sortChanged","title"))},[Tt,s.sortTxt==="title"?(l(),d("span",yt,k(n.sortDirArrow),1)):h("",!0)]),r("th",{onClick:e[1]||(e[1]=a=>t.$emit("sortChanged","importance"))},[_t,s.sortTxt==="importance"?(l(),d("span",gt,k(n.sortDirArrow),1)):h("",!0)]),r("th",{onClick:e[2]||(e[2]=a=>t.$emit("sortChanged","status"))},[vt,s.sortTxt==="status"?(l(),d("span",bt,k(n.sortDirArrow),1)):h("",!0)]),r("th",{onClick:e[3]||(e[3]=a=>t.$emit("sortChanged","triesCount"))},[Ct,s.sortTxt==="triesCount"?(l(),d("span",wt,k(n.sortDirArrow),1)):h("",!0)]),xt])]),s.tasks?(l(),d("tbody",Bt,[(l(!0),d(w,null,S(s.tasks,a=>(l(),d(w,{key:a._id},[x(i,{task:a,onPerformTask:n.performTask,onClick:T=>n.toggleDescription(a._id),onRemoveTask:n.removeTask},null,8,["task","onPerformTask","onClick","onRemoveTask"]),o.opened.includes(a._id)?(l(),d("tr",{class:"opened-tr",key:a._id+"1"},[r("td",St,[r("div",null,[Dt,r("p",{contenteditable:"",onBlur:T=>n.descriptionChanged(a._id,T.target.innerText)},k(a.description),41,At)]),a.errors.length?(l(),d("div",Ut,[Et,(l(!0),d(w,null,S(a.errors,(T,c)=>(l(),d("span",{key:c},[m(k(T)+" ",1),c<a.errors.length-1?(l(),d("span",Vt,",")):h("",!0)]))),128))])):h("",!0),r("div",It," Last tried at: "+k(a.updatedAt||"N/A")+" | Created at: "+k(a.createdAt)+" | Done at: "+k(a.doneAt||"N/A"),1),a.doneAt?h("",!0):(l(),d("button",{key:1,class:"btn delete details",onClick:T=>n.removeTask(a._id)}," Delete ",8,Lt))])])):h("",!0)],64))),128)),r("tr",null,[r("td",null,[r("label",null,[Rt,y(r("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=a=>o.newTask.title=a)},null,512),[[_,o.newTask.title]])])]),r("td",Pt,[r("label",null,[Mt,y(r("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.newTask.importance=a),type:"number",min:"1",max:"4"},null,512),[[_,o.newTask.importance]])])]),r("td",Nt,[r("button",{class:"btn save",onClick:e[6]||(e[6]=(...a)=>n.addTask&&n.addTask(...a))},"Save")])])])):h("",!0)])])}var Ot=v(pt,[["render",$t]]);const Ft={props:{options:{type:Array,default:[]},name:{type:String,required:!0},value:{type:Array,default:[]}},emits:["change","input","importance"],methods:{onChange(t,e){let s;console.log("im changed",e,t),e?(s=this.value.map(u=>u),s.push(t)):s=this.value.filter(u=>u!==t),this.$emit("input",[...s]),this.$emit("importance",[...s]),this.$emit("change")},capitalize(t){return t?(t=t.toString(),t.charAt(0).toUpperCase()+t.slice(1)):""}}},Wt=["name"],qt={class:"multi-checkbox-title"},Gt=["checked","name","onInput"];function jt(t,e,s,u,o,n){return l(),d("div",{class:"multi-checkbox",name:s.name},[r("span",qt,[$(t.$slots,"default")]),(l(!0),d(w,null,S(s.options,i=>(l(),d("label",{class:"checkbox-label",key:i},[r("input",{type:"checkbox",checked:s.value.includes(i),name:s.name,onInput:a=>n.onChange(i,a.target.checked)},null,40,Gt),m(" "+k(n.capitalize(i)),1)]))),128))],8,Wt)}var zt=v(Ft,[["render",jt]]);const Ht={data(){return{task:p.getEmptyTask()}}},Kt={class:"add-task-modal"},Jt=r("h4",null,"New Task",-1),Qt=m(" Task Title: "),Xt=m(" Task Description: "),Yt=m(" Task Importance: ");function Zt(t,e,s,u,o,n){return l(),d("div",Kt,[r("button",{class:"close-btn",onClick:e[0]||(e[0]=i=>t.$emit("close"))},"\u2716"),Jt,r("label",null,[Qt,y(r("input",{type:"text",placeholder:"Task name","onUpdate:modelValue":e[1]||(e[1]=i=>o.task.title=i)},null,512),[[_,o.task.title]])]),r("label",null,[Xt,y(r("input",{type:"text",placeholder:"Task description","onUpdate:modelValue":e[2]||(e[2]=i=>o.task.description=i)},null,512),[[_,o.task.description]])]),r("label",null,[Yt,y(r("input",{type:"number",min:"1",max:"4",placeholder:"importance","onUpdate:modelValue":e[3]||(e[3]=i=>o.task.importance=i)},null,512),[[_,o.task.importance]])]),r("button",{class:"btn",onClick:e[4]||(e[4]=i=>t.$emit("save",o.task))},"Add")])}var te=v(Ht,[["render",Zt]]),g={};const B=rt.getSocket(),ee={name:"App",data(){return{filterBy:{importance:[],status:[],title:"",sortTxt:"title",sortDir:1},showModal:!1,isRunning:!1,tasks:[]}},components:{taskTable:Ot,multiCheckbox:zt,AddTaskModal:te},async created(){B.on("taskUpdated",t=>{this.tasks=this.tasks.map(e=>e._id===t._id?t:e)}),B.on("setToggleWorker",({isRunning:t})=>{this.isRunning=t}),B.on("setTasks",()=>{this.loadTasks()});try{this.loadFilters(),this.loadTasks()}catch{g.error("Couldn't load tasks")}},methods:{async loadTasks(){try{this.tasks=await p.getTasks(this.filterBy)}catch{g.error("Couldn't load tasks")}},updateSort(t){this.filterBy.sortTxt===t?this.filterBy.sortDir=this.filterBy.sortDir*-1:(this.filterBy.sortTxt=t,this.filterBy.sortDir=1),this.filtersUpdated()},filtersUpdated(){const t=new URLSearchParams(this.filterBy);window.history.replaceState(null,null,"?"+t.toString()),this.loadTasks()},addStatus(t){this.filterBy.status=t},addImportance(t){this.filterBy.importance=t},async addTask(t){const e=await p.save(t);this.tasks.push(e),this.showModal=!1},async clearTasks(){try{await p.clearTasks(),this.tasks=await p.getTasks()}catch{g.error("Couldn't clear tasks")}},async toggleWorker(){p.toggleWorker()},isEmpty(t){return typeof t=="array"?t.length===0:!!t},async generateTasks(){try{var t=await p.generateTasks();t&&(this.tasks=await p.getTasks())}catch{g.error("Couldn't generate new tasks")}},async removeTask(t){try{await p.remove(t),this.tasks=this.tasks.filter(e=>e._id!==t)}catch(e){g.error(`could not remove task id ${t}`,e)}},performTask(t){p.startTask(t)},loadFilters(){new URLSearchParams(window.location.search).forEach((e,s)=>{if(!!this.isEmpty(e)){if(e.includes(",")){this.filterBy[s]=e.split(",");return}s==="importance"||s==="status"?this.filterBy[s]=[e]:s==="sortDir"?this.filterBy[s]=parseInt(e):this.filterBy[s]=e}})},updateTask(t){p.save(t)}}},se={id:"app"},ne=r("header",{class:"title"},"Mister Tasker",-1),re={class:"btns-container"},oe=m(" task worker "),ae={class:"filters-container"},ie=m(" Importance "),le=m(" Filter by text: "),de=m(" Status ");function ue(t,e,s,u,o,n){const i=C("multi-checkbox"),a=C("task-table"),T=C("add-task-modal");return l(),d("div",se,[ne,r("div",re,[r("button",{class:"btn",onClick:e[0]||(e[0]=(...c)=>n.generateTasks&&n.generateTasks(...c))},"Generate Tasks"),r("button",{class:"btn",onClick:e[1]||(e[1]=(...c)=>n.clearTasks&&n.clearTasks(...c))},"Clear Tasks"),r("button",{class:"btn",onClick:e[2]||(e[2]=c=>o.showModal=!0)},"Create new task"),r("button",{onClick:e[3]||(e[3]=(...c)=>n.toggleWorker&&n.toggleWorker(...c)),class:"btn toggle"},[r("span",null,k(o.isRunning?"stop":"start"),1),oe])]),r("div",ae,[x(i,{options:["1","2","3","4"],onImportance:n.addImportance,onChange:n.filtersUpdated,modelValue:o.filterBy.importance,"onUpdate:modelValue":e[4]||(e[4]=c=>o.filterBy.importance=c),"is-multi":!0,name:"importance"},{default:V(()=>[ie]),_:1},8,["onImportance","onChange","modelValue"]),r("label",null,[le,y(r("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=c=>o.filterBy.title=c),onChange:e[6]||(e[6]=(...c)=>n.filtersUpdated&&n.filtersUpdated(...c)),placeholder:"search for a title"},null,544),[[_,o.filterBy.title]])]),x(i,{options:["new","done","fail"],onChange:n.filtersUpdated,onInput:n.addStatus,modelValue:o.filterBy.status,"onUpdate:modelValue":e[7]||(e[7]=c=>o.filterBy.status=c),"is-multi":!0,name:"status"},{default:V(()=>[de]),_:1},8,["onChange","onInput","modelValue"])]),x(a,{tasks:o.tasks,sortTxt:o.filterBy.sortTxt,sortDir:o.filterBy.sortDir,onPerformTask:n.performTask,onRemoveTask:n.removeTask,onAddTask:n.addTask,onUpdateTask:n.updateTask,onSortChanged:n.updateSort},null,8,["tasks","sortTxt","sortDir","onPerformTask","onRemoveTask","onAddTask","onUpdateTask","onSortChanged"]),o.showModal?(l(),O(T,{key:0,onSave:n.addTask,onClose:e[8]||(e[8]=c=>o.showModal=!1)},null,8,["onSave"])):h("",!0)])}var ce=v(ee,[["render",ue]]);const ke=F(ce);ke.mount("#app");
